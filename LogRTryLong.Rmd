---
title: "LoGRTryLong"
author: "Mohd Azmi"
date: "01/11/2019"
output: html_document
---

# Pre-amble

## Library

```{r Library, message=F}
library(haven)
library(knitr)
library(tidyr)
library(psych)
library(ggplot2)
library(dplyr)
library(broom)
```

## Dataset

Import dataset

```{r Import Dataset}
LogDS <- read_dta("diabetes.dta")
kable(head(LogDS))
```

Convert categorical data

```{r Convert Categorical Data}
LogDS$dmdxcat <- as_factor(LogDS$dmdx)
LogDS$gendercat <- as_factor(LogDS$gender)
LogDS$cruralcat <- as_factor(LogDS$crural)
kable(head(LogDS))
```

alternatively, dplyr::mutate can also be use

```{r convert alternative}
LogDS2 <- LogDS %>%
  mutate (dmdxcat = as_factor(dmdx),
          gendercat = as_factor(gender),
          cruralcat = as_factor(crural))
kable(head(LogDS2))
```



# Data Exploration

## Data summary

```{r Data Summary, message=F}
kable(summary(LogDS [, 20:22]))
kable(describe(LogDS [, 2:19]))
```

## Data Visualization

Histogram for numerical data

```{r Historgram numerical, message=F}
ggplot(LogDS, aes(age)) +
  geom_histogram(aes(y=..density..)) +
  stat_function(fun = dnorm, colour = "red",
                args = list(mean = mean(LogDS$age),
                            sd = sd(LogDS$age)))
ggplot(LogDS, aes(height)) +
  geom_histogram(aes(y=..density..)) +
  stat_function(fun = dnorm, colour = "red",
                args = list(mean = mean(LogDS$height),
                            sd = sd(LogDS$height)))

ggplot(LogDS, aes(weight)) +
  geom_histogram(aes(y=..density..)) +
  stat_function(fun = dnorm, colour = "red",
                args = list(mean = mean(LogDS$weight),
                            sd = sd(LogDS$weight)))

ggplot(LogDS, aes(hba1c)) +
  geom_histogram(aes(y=..density..)) +
  stat_function(fun = dnorm, colour = "red",
                args = list(mean = mean(LogDS$hba1c),
                            sd = sd(LogDS$hba1c)))

ggplot(LogDS, aes(fbs)) +
  geom_histogram(aes(y=..density..)) +
  stat_function(fun = dnorm, colour = "red",
                args = list(mean = mean(LogDS$fbs),
                            sd = sd(LogDS$fbs)))

ggplot(LogDS, aes(mogtt2h)) +
  geom_histogram(aes(y=..density..)) +
  stat_function(fun = dnorm, colour = "red",
                args = list(mean = mean(LogDS$mogtt2h),
                            sd = sd(LogDS$mogtt2h)))

ggplot(LogDS, aes(totchol)) +
  geom_histogram(aes(y=..density..)) +
  stat_function(fun = dnorm, colour = "red",
                args = list(mean = mean(LogDS$totchol),
                            sd = sd(LogDS$totchol)))

ggplot(LogDS, aes(ftrigliz)) +
  geom_histogram(aes(y=..density..)) +
  stat_function(fun = dnorm, colour = "red",
                args = list(mean = mean(LogDS$ftrigliz),
                            sd = sd(LogDS$ftrigliz)))

ggplot(LogDS, aes(hdl)) +
  geom_histogram(aes(y=..density..)) +
  stat_function(fun = dnorm, colour = "red",
                args = list(mean = mean(LogDS$hdl),
                            sd = sd(LogDS$hdl)))

ggplot(LogDS, aes(ldl)) +
  geom_histogram(aes(y=..density..)) +
  stat_function(fun = dnorm, colour = "red",
                args = list(mean = mean(LogDS$ldl),
                            sd = sd(LogDS$ldl)))
```

Bar chart for categorical data

```{r Barchart categorical}
ggplot(LogDS, aes(dmdxcat)) +
  geom_bar()
ggplot(LogDS, aes(gendercat)) +
  geom_bar()
ggplot(LogDS, aes(cruralcat)) +
  geom_bar()
```

Correlation Matrix among Numerical Data

```{r Corrplot for Numerical Data}
LogDSNum <- LogDS %>%
  select_if(is.numeric)
CorLogDSNum <- cor(LogDS_Num, use = "complete.obs", method = "pearson")
kable(round(CorLogDSNum,2))
```



# Logistic Regression Modelling

## Univariable - Simple Logistic Regression

### Model01 - age

Model01

- outcome: dmstatus
- predictor - age

```{r SLogR Age}
Model01 <- glm(dmdxcat ~ age,
               data = LogDS,
               family = binomial (link = "logit"))
summary(Model01)
kable(tidy(Model01))
```

### Model02 - Gender

Model02

- outcome: dm status
- predictor - gender

```{r SLogR Gender}
Model02 <- glm(dmdxcat ~ gender,
               data = LogDS,
               family = binomial (link = "logit"))
summary(Model02)
kable(tidy(Model02))
```

## Multivariable - Multiple Logistic Regression

### Model11 - age & gender

Model11

- outcome: dm
- predictor: age, gender

```{r MLogR Age Gender}
Model11 <- glm(dmdxcat ~ age + gendercat,
               family = binomial(link = "logit"),
               data = LogDS)
summary(Model11)
kable(tidy(Model11))
```

Calculate OR and 95% CI

```{r OR for Model11, message=F}
Table_Model11 <- tidy(Model11)
OR_Model11 <- exp(coefficients(Model11))
ORCI_Model11 <- exp(confint(Model11))
kable(cbind(Table_Model11 [, 1:5], OR_Model11, ORCI_Model11))
```

## Inference - MLE method (Wald Test)

### Wald Test for Age

$W = \beta/SE_\beta$

Example 1, calculate Wald test for Model01 (age)

```{r Wald for SLogR Age}
0.0511159/0.0038629
```

p-value for above.

```{r p-value for W test Model01}
2*pnorm(-abs(0.0511159/0.0038629))
```


### Wald Test for Gender

Wald Test for Model02 (gender)

```{r Wald for SLogR Gender}
0.2222904/0.1025100
```

p-value for above

```{r p-value for W test Model02}
2*pnorm(-abs(0.2222904/0.1025100))
```

## Inference - SE method (Confident Interval)

### CI for Age

CI for Model01

```{r CI for Model01}
kable(tidy(confint(Model01)))
```

the confident interval didn't cross 1

## Inference - Likelihood Ratio Test

### LR Test fot Model01 with Model11

- Model01 - age as covariate
- Model11 - age and gender as covariate

to explore LR when gender is added to Model01

```{r LR test}
anova(Model11, Model01, test="Chisq")
```

### LR Test fot Model02 with Model11

- Model02 - gender as covariate
- Model11 - age and gender as covariate

to explore LR when age is added to Mofrl02

```{r LR test}
anova(Model11, Model02, test="Chisq")
```

## Model Selection

